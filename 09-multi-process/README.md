# 概要
こちらはオマケのセクションです。AWSリソースを用いたスコアアップではなくアプリケーションの設定を修正します。  

今回扱っているPrivate-isuのRubyの実装では、`unicorn`というサーバーライブラリが利用されており、これは1プロセスで1リクエストを処理するアーキテクチャになっています。

また、今まで`top`コマンドで見てきたように、`ruby`のプロセスは1つしか起動していません。

![](/images/2025-05-27-06-55-03.png)

つまり、現状では1つのEC2インスタンスで1つのリクエストしか処理できない状態になっています。  
そこで、複数のリクエストを同時に処理できるように、unicornの設定を変更してみましょう。

# 複数CPUを利用する為の設定
1. `~/private_isu/webapp/ruby/unicorn_config.rb`がunicornの設定ファイルパスになります。
    設定ファイルの初期状態は以下です。
    ```
    worker_processes 4
    preload_app true
    listen "0.0.0.0:8080"
    ```
    上記の`worker_processes`の値を4に変更してください(2インスタンスとも同様に変更します)。

2. アプリの再起動  
    `unicorn_config.rb`の編集後、アプリを再起動します。
    ```
    sudo systemctl restart isu-ruby
    ```
3. ベンチマークの実行と考察  
    ベンチマークを実行し、スコアを比較してください。   
    コア数を変動させて最適なworkerプロセス数を見つけてみてください。  
    その際に、今回使っているインスタンスタイプとそのCPUコア数を確認しておくと良いでしょう。

[⬅️ 前のセクションへ](../08-multi-ec2-instances/README.md)
